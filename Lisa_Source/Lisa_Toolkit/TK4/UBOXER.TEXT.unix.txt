    {LisaBoxer: a box-drawing application for the Tool Kit}
    {Copyright 1983, 1984, Apple Computer Inc.}

{$E ERRORS.TEXT}
{$E+}               {go into the editor automagically}

UNIT UBoxer;

INTERFACE

USES
    {$U UObject}            UObject,
    {$U QuickDraw}          QuickDraw,
    {$U UDraw}              UDraw,
    {$U UABC}               UABC,
    {$U UUnivText}          UTKUniversalText,
    {$U UText}              UText,
    {$U UDialog}            UDialog,
    {$U UPalette}           UPalette;  {UPalette.OBJ must be on prefix volume}

CONST

  {Codes to represent box colors}
    colorFirst = 1;

    colorWhite = 1;
    colorLtGray = 2;
    colorGray = 3;
    colorDkGray = 4;
    colorBlack = 5;

    colorLast = 5;

  {Application-specific command numbers}
    uWhite = 1006;
    uLtGray = 1007;
    uGray = 1008;
    uDkGray = 1009;
    uBlack = 1010;
    uShades = 1011;
    uOKShades = 1012;

    uFront = 1020;
    uBack = 1021;

    uDuplicate = 1050;

    uCreateBox = 2000;
    uMoveBoxes = 2001;

    uSplitH    = 5000;
    uSplitV    = 5001;
    uRemHSplit = 5002;
    uRemVSplit = 5003;
    uRemAllSplit = 5004;
    uSaveSplits =   5005;

  {Selection kinds}
    pickKind = 1;
    unPickKind = 2;
    sketchKind = 3;
    areaKind = 4;

  {Alert numbers}
    phMustClick = 1001;
    phNoSplit  = 1002;

    phWhite = 3301;
    phLightGray = 3302;
    phGray = 3303;
    phDarkGray = 3304;
    phBlack = 3305;

  { dimensions of a box in palette }
    palWidth  = 36;
    palHeight = 24;

  { distance between edge of palette box and the prototype box }
    hPalMargin = 6;
    vPalMargin = 4;

  { row numbers in action palette }
    symArrow    =   1;
    symBox      =   2;

  { amount to offset on a duplicate }
    hDupOffset  =   9;
    vDupOffset  =   6;

    mnuTypeStyle = 101;
TYPE
    TColor = colorFirst..colorLast; {color of a box}

  {New Classes for this Application}

    TBox = SUBCLASS OF TObject

        {Variables}
        shapeLRect:     LRect;
        color:          TColor;
        isSelected:     BOOLEAN;
        wasSelected:    BOOLEAN;

      {Creation/Destruction}
        FUNCTION  {TBox.}CREATE(object: TObject; itsHeap: THeap; itsShape: LRect; itsColor: TColor): TBox;

      {Display}
        PROCEDURE {TBox.}Draw;
        PROCEDURE {TBox.}Highlight(highTransit: THighTransit);
        PROCEDURE {TBox.}InvalInTheView(view: TView);
        PROCEDURE {TBox.}Outline;

      {Enumerate Handles}
        PROCEDURE {TBox.}EachHandleRect(PROCEDURE DoToHandle(hRect: Rect));

        END;


  {Subclasses of Generic Classes}

    TBoxProcess = SUBCLASS OF TProcess

      {Creation/Destruction}
        FUNCTION  {TBoxProcess.}CREATE(object: TObject; itsHeap: THeap): TBoxProcess;
       {PROCEDURE  TBoxProcess. Commence(phraseVersion: INTEGER);}
       {FUNCTION   TBoxProcess. NewDocManager(volumePrefix: TFilePath; openAsTool: BOOLEAN): TDocManager;}
        END;


    TBoxDocManager = SUBCLASS OF TDocManager

      {Creation/Destruction}
        FUNCTION  {TBoxDocManager.}CREATE(object: TObject; itsHeap: THeap; itsPathPrefix: TFilePath)
                               : TBoxDocManager;
       {FUNCTION   TBoxDocManager. NewWindow(heap: THeap; wmgrID: TWindowID): TWindow;}
        END;


    TBoxWindow = SUBCLASS OF TWindow

      {Variables}
        actions:        TPanel;
        boxes:          TPanel;

      {Creation/Destruction}
        FUNCTION  {TBoxWindow.}CREATE(object: TObject; itsHeap: THeap; itsWmgrID: TWindowID): TBoxWindow;

      {Document Creation}
       {PROCEDURE  TBoxWindow. BlankStationery;}

      {Menus}
       {FUNCTION   TBoxWindow. CanDoCommand(cmdNumber: TCmdNumber; VAR checkIt: BOOLEAN): BOOLEAN;}

      {Commands}
       {FUNCTION   TBoxWindow. NewCommand(cmdNumber: TCmdNumber): TCommand;}
        PROCEDURE {TBoxWindow.}SelectAll;

      {Actions Palette}
        PROCEDURE {TBoxWindow.}SetAction(action: INTEGER; doHilite: BOOLEAN);

      {Dialogs}
       {PROCEDURE  TBoxWindow. PutUpDialogBox(dialogBox: TDialogBox);}
       {PROCEDURE  TBoxWindow. TakeDownDialogBox;}
        END;


  {Palette subclasses}
    TActView = SUBCLASS OF TPalView
      {Variables}
        palBox: TBox;   {same TBox as in the TBoxView}

      {Creation/Destruction}
        FUNCTION  {TActView.}CREATE(object: TObject; itsHeap: THeap; itsPanel: TPanel; itsPalBox: TBox)
                           : TActView;

      {Display}
       {PROCEDURE  TActView. DrawSymbol(atCol, atRow: INTEGER;}
       {PROCEDURE  TPalView. ChangedSelection(atCol, atRow: INTEGER);}

      {Mouse Tracking}
       {PROCEDURE  TActView. MouseRelease;}

        END;

    TBoxView = SUBCLASS OF TView

      {Variables}
        boxList:    TList;
        palBox:     TBox;   {same TBox as in the TActView}
        doingMove:  BOOLEAN;{TRUE iff we are moving boxes, so that we do not draw the selected boxes,
                                but only outline them.}

      {Creation/Destruction}
        FUNCTION  {TBoxView.}CREATE(object: TObject; itsHeap: THeap; itsPanel: TPanel; itsExtent: LRect;
                                 itsPalBox: TBox; itsBoxList: TList): TBoxView;

      {Display}
       {PROCEDURE  TBoxView. Draw;}
        PROCEDURE {TBoxView.}InvalBounds(bounds: LRect; isSelected: BOOLEAN);
        PROCEDURE {TBoxView.}ToggleHighlight(box: TBox);

      {Mouse Tracking}
        FUNCTION  {TBoxView.}BoxWith(LPt: LPoint): TBox;
       {FUNCTION   TBoxView. CursorAt(mouseLPt: LPoint): TCursorNumber;}
       {FUNCTION   TBoxView. MousePress(mouseLPt: LPoint): BOOLEAN;}

      {Filtering}
       {PROCEDURE  TBoxView. EachActualPart(PROCEDURE DoToBox(obj: TObject));}

      {Utility}
        PROCEDURE {TBoxView.}FixLRectDelta(bounds: LRect; VAR deltaLPt: LPoint);
                                {considers the LRect formed by offsetting bounds by deltaLPt, and
                                    changes deltaLPt so that the resulting LRect lies within the
                                    view's extentLRect}
        END;


    { selection classes:
        The panel will ALWAYS contain a TPickSelection, except when in the process of
            creating a new box.  The kind of the selection will be nothingKind iff the
            boundLRect is empty; unPickKind if the user just de-selected a box by shift
            clicking; otherwise, pickKind.}

    TPickSelection = SUBCLASS OF TSelection

      {Variables}

      {Creation/Destruction}
        FUNCTION  {TPickSelection.}CREATE(object: TObject; itsHeap: THeap; itsView: TView; itsKind: INTEGER;
                                       itsAnchorLPt: LPoint): TPickSelection;

      {Drawing - per pad}
       {PROCEDURE  TPickSelection. Highlight(highTransit: THighTransit);}

      {Selection - per pad}
        PROCEDURE {TPickSelection.}ComputeBoundingBox;
       {PROCEDURE  TPickSelection. MouseMove(mouseLPt: LPoint);}
       {PROCEDURE  TPickSelection. MouseRelease;}
       {PROCEDURE  TPickSelection. Restore;}
       {PROCEDURE  TPickSelection. Save;}

      {Command Dispatch}
       {PROCEDURE  TPickSelection. NewCommand(cmdNumber: TCmdNumber): TCommand;}

        END;


    TAreaSelection = SUBCLASS OF TSelection
      {Variables}
        shiftKey:   BOOLEAN;

      {Creation/Destruction}
        FUNCTION  {TAreaSelection.}CREATE(object: TObject; itsHeap: THeap; itsView: TView;
                                       itsAnchorLPt: LPoint; itsShiftKey: BOOLEAN): TAreaSelection;

      {Drawing - per pad}
       {PROCEDURE  TAreaSelection. Highlight(highTransit: THighTransit);}

      {Selection - per pad}
        PROCEDURE {TAreaSelection.}ComputeBoundingBox;
       {PROCEDURE  TAreaSelection. MouseMove(mouseLPt: LPoint);}
       {PROCEDURE  TAreaSelection. MouseRelease;}

        END;


    TSketchSelection = SUBCLASS OF TSelection

      {Variables}
        box:            TBox;

      {Creation/Destruction}
        FUNCTION  {TSketchSelection.}CREATE(object: TObject; itsHeap: THeap; itsView: TBoxView;
                                         itsAnchorLPt: LPoint): TSketchSelection;

      {Drawing - per pad}
       {PROCEDURE  TSketchSelection. Highlight(highTransit: THighTransit);}

      {Selection - per pad}
       {PROCEDURE  TSketchSelection. MouseMove(mouseLPt: LPoint);}
       {PROCEDURE  TSketchSelection. MouseRelease;}

        END;


    TRecolorCmd = SUBCLASS OF TCommand

      {Variables}
        newColor:       TColor; {when the command is first done this is copied to the view}

      {Creation}
        FUNCTION  {TRecolorCmd.}CREATE(object: TObject; itsHeap: THeap; itsCmdNumber: TCmdNumber;
                                    itsView: TBoxView; itsColor: TColor): TRecolorCmd;

      {Command Execution}
       {PROCEDURE  TRecolorCmd. Commit;}
       {PROCEDURE  TRecolorCmd. Perform(cmdPhase: TCmdPhase);}
       {PROCEDURE  TRecolorCmd. EachVirtualPart(PROCEDURE DoToObject(obj: TObject));}

        END;


    TMoveCmd = SUBCLASS OF TCommand

      {Variables}
        hOffset:    LONGINT;
        vOffset:    LONGINT;

      {Creation}
        FUNCTION  {TMoveCmd.}CREATE(object: TObject; itsHeap: THeap; itsCmdNumber: TCmdNumber;
                                 itsView: TBoxView; itsHOffset, itsVOffset: LONGINT): TMoveCmd;

      {Command Execution}
       {PROCEDURE  TMoveCmd. Perform(cmdPhase: TCmdPhase);}

        END;

    TBoxCutCopyCmd = SUBCLASS OF TCutCopyCommand

      {Variables}
        selTopLeft:     LPoint;

      {Creation}
        FUNCTION  {TBoxCutCopyCmd.}CREATE(object: TObject; itsHeap: THeap; itsCmdNumber: TCmdNumber;
                                       itsView: TView; isCutCmd: BOOLEAN; itsTopLeft: LPoint): TBoxCutCopyCmd;

      {Command Execution}
       {PROCEDURE  TBoxCutCopyCmd. Commit;}
       {PROCEDURE  TBoxCutCopyCmd. DoCutCopy(clipSelection: TSelection; deleteOriginal: BOOLEAN;
                                             cmdPhase: TCmdPhase);}
       {PROCEDURE  TBoxCutCopyCmd. EachVirtualPart(PROCEDURE DoToObject(obj: TObject));}
        END;

    TClearCmd = SUBCLASS OF TBoxCutCopyCmd

      {Variables}

      {Creation}
        FUNCTION  {TClearCmd.}CREATE(object: TObject; itsHeap: THeap; itsCmdNumber: TCmdNumber;
                                  itsView: TBoxView; itsTopLeft: LPoint): TClearCmd;

      {Command Execution}
       {PROCEDURE  TClearCmd. Perform(cmdPhase: TCmdPhase);}
        END;

    TBoxPasteCmd = SUBCLASS OF TPasteCommand

      {Variables}
        pasteBoxList:   TList;

      {Creation and Destruction}
        FUNCTION  {TBoxPasteCmd.}CREATE(object: TObject; itsHeap: THeap; itsCmdNumber: TCmdNumber;
                                        itsView: TBoxView): TBoxPasteCmd;
       {PROCEDURE  TBoxPasteCmd. Free;}

      {Command Execution}
       {PROCEDURE  TBoxPasteCmd. Commit;}
       {PROCEDURE  TBoxPasteCmd. DoPaste(clipSelection: TSelection; pic: PicHandle; cmdPhase: TCmdPhase);}
       {PROCEDURE  TBoxPasteCmd. EachVirtualPart(PROCEDURE DoToObject(obj: TObject));}
        PROCEDURE {TBoxPasteCmd.}FinishPaste(cmdPhase: TCmdPhase);
            {This invalidates the pasted boxes and does other stuff needed to finish the command.}

        END;

    TSketchBoxCmd = SUBCLASS OF TBoxPasteCmd
      {Variables}
        {pasteList is created by the CREATE method}

      {Creation and Destruction}
        FUNCTION  {TSketchBoxCmd.}CREATE(object: TObject; itsHeap: THeap; itsCmdNumber: TCmdNumber;
                                    itsView: TBoxView; itsBox: TBox): TSketchBoxCmd;

      {Command Execution}
       {PROCEDURE  TSketchBoxCmd. Perform(cmdPhase: TCmdPhase);}
        END;

    TDuplicateCmd = SUBCLASS OF TBoxPasteCmd
      {Variables}
        {pasteList is created by the CREATE method}

      {Creation}
        FUNCTION  {TDuplicateCmd.}CREATE(object: TObject; itsHeap: THeap; itsCmdNumber: TCmdNumber;
                                      itsView: TBoxView; itsPickSelection: TPickSelection): TDuplicateCmd;
        END;

    TFrontBackCmd = SUBCLASS OF TCommand

      {Variables}
        sendToBack:     BOOLEAN;

      {Creation}
        FUNCTION  {TFrontBackCmd.}CREATE(object: TObject; itsHeap: THeap; itsCmdNumber: TCmdNumber;
                                         itsView: TBoxView; isSendToBack: BOOLEAN): TFrontBackCmd;

      {Command Execution}
       {PROCEDURE  TFrontBackCmd. Commit;}
       {PROCEDURE  TFrontBackCmd. Perform(cmdPhase: TCmdPhase);}
       {PROCEDURE  TFrontBackCmd. EachVirtualPart(PROCEDURE DoToObject(obj: TObject));}

        END;


IMPLEMENTATION

  {$I UBoxer2.text}

END.
ÿ